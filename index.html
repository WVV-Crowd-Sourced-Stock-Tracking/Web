<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/style/index.css">

    <title>WVV</title>

  </head>

  <body>

    <div id="list" class="view visible">
      List
    </div>

    <div id="shopping-list" class="view">
      Shopping List
    </div>

    <div id="map" class="view">
      <div id="map-embedded"></div>
    </div>

    <nav>
      <ul>
        <li id="nav-list" class="active" onclick="viewSwitcher.showMarkets();">
          <img src="/media/icons/search.svg" alt="Suche">
          <br>
          <span>Suche</span>
        </li>
        <li id="nav-shopping-list" onclick="viewSwitcher.showCart();">
          <img src="/media/icons/shopping-cart.svg" alt="Einkaufsliste">
          <br>
          <span>Einkaufsliste</span>
        </li>
        <li id="nav-map" onclick="viewSwitcher.showMap();">
          <img src="/media/icons/map-2.svg" alt="Karte">
          <br>
          <span>Karte</span>
        </li>
      </ul>
    </nav>

    <script src="/scripts/view-switcher.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCIHJCRgVNdpdHQigIEebTzT4RDiTwt6jk&callback=initMap"
    defer></script>
    <script src="/scripts/map-context.js"></script>
    <script src="/scripts/api.js"></script>
    <script src="/scripts/market.js"></script>
    <script src="/scripts/listings.js"></script>
    <script>

      var viewSwitcher, api, listing, map, mapContext;

      window.onload = async () => {

        viewSwitcher = new ViewSwitcher('list', 'shopping-list', 'map');
        api = new API();
        listing = new Listing();

        try {
          map = await initMap();
        } catch (err) {
          console.error(err);  
        }
        console.log('map:', map);
        mapContext = new MapContext(map);
        
      }

      function initMap() {
        return new Promise((resolve, reject) => {
        
          if (!navigator.geolocation) {
            console.log('Geolocation is not supported by your browser');
          } else {
            console.log('Locatingâ€¦');
            navigator.geolocation.getCurrentPosition(position => {
              console.log('position:', position);

              return resolve(new google.maps.Map(document.querySelector('#map-embedded'), {
                center: {lat: position.coords.latitude, lng: position.coords.longitude},
                zoom: 15,
              }));
              
            }, err => {
              reject(err);
            });
          }          
        
        })
      }

      
      
    </script>
    
  </body>

</html>